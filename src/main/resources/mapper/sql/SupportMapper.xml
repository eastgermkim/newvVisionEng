<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <!-- namespace는 Mapper 인터페이스와 같은 이름으로 해야 자동 병합 처리된다. -->
<mapper namespace="com.newvisioneng.mapper.SupportMapper">
	
	<select id="getNoticeList" resultType="com.newvisioneng.domain.NoticeDTO">
		SELECT NOTICENUM,NOTICEDATE,READCOUNT, NOTICEWRITER,NOTICETITLE,NOTICECONTENTS 
		FROM NV_NOTICE ORDER BY NOTICENUM DESC LIMIT #{pageStart},#{pageSize}
	</select>
	
	<select id="getNoticeTotal" resultType="_int">
		SELECT COUNT(*) FROM NV_NOTICE WHERE NOTICENUM>0
	</select>
	
	
	
	
	
	
	
	
	
	
	
	
	
	<!-- 공지사항 글 등록 -->
	<insert id="insertNotice" parameterType="com.newvisioneng.domain.NoticeDTO">
		<!-- NOTICENUM은 NULL로 삽입시에 자동으로 1 증가한 값으로 들어간다(auto_increment) -->
		<![CDATA[
		INSERT INTO NV_NOTICE VALUES(NULL,#{noticeWriter},#{noticeTitle},#{noticeContents},now(),1)
		]]>
		
		<!-- insert하면서 AUTO_INCREMENT된 noticeNum를 바로 가져와야한다.-->
		<!-- 가장 최근에 성공적으로 수행된 INSERT 구문의 첫번째 AUTO_INCREMENT column의 값을 반환한다 -->
		<!-- 반환된 값은 들어온 NoticeDTO의 noticeNum에 담아진다(리턴 형태가 아님) -->
		<selectKey keyProperty="noticeNum" resultType="_long">
        SELECT LAST_INSERT_ID()
   		</selectKey>
	</insert>
	
	<!-- 공지사항 파일 등록 -->
	<insert id="insertNoticeFile" parameterType="hashmap">
        INSERT INTO NV_NOTICE_FILE VALUES
        (#{SYSTEMNAME},#{ORGNAME},#{BOARDNUM})
	</insert>
	
	<!-- 공지사항 글 조회 -->
	<select id="readNotice" resultType="com.newvisioneng.domain.NoticeDTO">
		SELECT * FROM NV_NOTICE WHERE NOTICENUM = #{noticeNum}	
	</select>
	
	<!-- 공지사항 글 조회시 파일도 함께 -->
	<select id="readNoticeFile" parameterType="_long" resultType="hashMap">
        SELECT * FROM NV_NOTICE_FILE WHERE NOTICENUM = #{noticeNum}
	</select>
	
</mapper>












